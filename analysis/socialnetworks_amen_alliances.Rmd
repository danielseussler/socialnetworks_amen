---
title: The Additive and Multiplicative Effects Model
subtitle: Seminar on Statistical Modeling of Social Networks
author: Daniel A. Seussler Becerra
date: "June 2021"
output:
  bookdown::pdf_document2: 
    fig_caption: yes
classoption: twoside
fontsize: 11pt
toc: false
geometry: margin=1in 
bibliography: 
  - references.bib
header-includes:
  - \usepackage{float}
  - \usepackage{natbib}\bibliographystyle{agsm}
keywords: Social Networks, Dyadic Data, Bayesian estimation, Latent Factors, International Relations.
abstract: "This seminar paper introduces the Additive and Multiplicative Effects Network Model as proposed in @Hoff2021. First, a general introduction to network and relational data is given along with the statistical challenges of dyadic data analysis. Second, the Additive and Multiplicative Effects model ist introduced and motivated. I then apply this to data from the Alliances Treaty and Obligations Project (ATOP) in the year 2000. *Keywords: Social Networks, Dyadic Data, Bayesian estimation, Latent Factors, International Relations.*"
thanks: "Replication files are available on Github (http://github.com/danielseussler). **Current version**: `r format(Sys.time(),'%B %d, %Y')`; **Corresponding author**: daniel.seussler@gmail.com"
nocite: |
  @ComplexDependencies, @TowardNetwork, @Hoff2007, @Hoff2005, @ATOPData, @hoff2015dyadic, @Hoff2021, @minhas_hoff_ward_2019, @Minhas_Hoff_Ward_2016
---

\newpage

# Introduction
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.Aenean ma ssa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,


# Theory
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,



**Network Effects** 

* 1st-order: Sender (Receiver) Effects
* 2nd-order: Reciprocity
* 3rd-order: Homophily & Stochastic Equivalence
* System-level - changing actor composition



**The Social Relations Model**

Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,

\begin{align*}
\begin{aligned}
      y_{ij} &= \mu + e_{ij} \\
      e_{ij} &= a_{i} + b_{j} + \epsilon_{ij} \\
      \{ (a_{1}, b_{1}), \ldots, (a_{n}, b_{n}) \} &\sim N(0,\Sigma_{ab}) \\ 
      \{ (\epsilon_{ij}, \epsilon_{ji}) : \; i \neq j\} &\sim N(0,\Sigma_{\epsilon}), \text{ where } \\
      \Sigma_{ab} = \begin{pmatrix} \sigma_{a}^{2} & \sigma_{ab} \\ 
      \sigma_{ab} & \sigma_{b}^2   \end{pmatrix} \;\;\;\;\; &\Sigma_{\epsilon} = \sigma_{\epsilon}^{2} \begin{pmatrix} 1 & \rho \\ 
      \rho & 1  \end{pmatrix}
\end{aligned}
\end{align*}


**The Latent Factor Model**

\begin{align*}
  {\textbf{u}_{i},\textbf{v}_{j}} \in \mathbb{R}^{k} \;\; i,j \in \{1, \ldots, n \} \\
\end{align*}

\begin{align*}
\begin{aligned}
  \gamma(\textbf{u}_{i}, \textbf{v}_{j}) &= \textbf{u}_{i}^{T} D \textbf{v}_{j} \\
  &= \sum_{k \in K} d_{k} u_{ik} v_{jk} \\
  &D \text{ is a  } K \times K \text{ diagonal matrix}
\end{aligned}
\end{align*}


**Bringing it all together: The AME Network Model**

\begin{align*}
  \begin{aligned}
      y_{ij,t} &= g(\theta_{ij,t}) \\ 
      &\theta_{ij,t} = \beta^{T} \mathbf{X}_{ij,t} + e_{ij,t} \\
      &e_{ij,t} = a_{i} + b_{j}  + \epsilon_{ij} + \alpha(\textbf{u}_{i}, \textbf{v}_{j}) \text{  , where } \\
      &\qquad \alpha(\textbf{u}_{i}, \textbf{v}_{j}) = \textbf{u}_{i}^{T} \textbf{D} \textbf{v}_{j} = \sum_{k \in K} d_{k} u_{ik} v_{jk} \\ 
  \end{aligned}
\end{align*}


**Parameter Estimation and Goodness of Fit**

Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,

**Modeling Longitudinal Data**


\newpage
# Application case: The Alliances Data Set
In this section the above introduced additive and multiplicative effects model is applied to the network of international defense alliance network. The data is an excerpt from the data used in @ComplexDependencies and @TowardNetwork and contains the yearly defense network as a time series from 1981 - 2000.^[The data set `alliances` can be conveniently accessed as network data in the R-Package `xergm.common`.] It furthermore includes information on military capabilites, political regime types, geographic borders and interstate conflict. From here on out, I refer to this data set as the `alliances` data set. 

The analysis is structured as follows. First, restricted to a cross-sectional study of the year 2000, I examine the alliances structure with respect to the network statistics and preliminary models to motivate the application of statistical network approaches. Second, a full specification of an AME-model is presented, along with the selection of appropiate parameters. Third, I extend briefly the analysis to include a longitudinal analysis of the interstate alliances network capturing the years 1981-2000. The analysis was implemented with the R-Software (@rsoftware) and the AMEN R-Package (@ramen).

```{r setup, echo=FALSE, message=FALSE}
# These options are tuned for manuscript/presentation.
# They basically run R in the background except for spitting out figures/tables

knitr::opts_chunk$set(
	echo = FALSE,
	error = FALSE,
	message = FALSE,
	warning = FALSE
)

library(amen)
library(xergm.common)
library(network)
library(stargazer)
data("alliances")
set.seed(42)

```

```{r output_help, include=FALSE}
# Modified summary function of amen package to output a table easier to handle
table_ame <- function(object, ...){ 
  fit <- object
  tmp <- cbind(
    apply(fit$BETA, 2, mean), apply(fit$BETA, 2, sd),
    apply(fit$BETA, 2, mean) / apply(fit$BETA, 2, sd),
    2 * (1 - pnorm(abs(apply(fit$BETA, 2, mean) / apply(fit$BETA, 2, sd))))
  )
  colnames(tmp) <- c("pmean", "psd", "z-stat", "p-val")
  out <- round(tmp, 4)
  
  
  tmp <- cbind(apply(fit$VC, 2, mean), apply(fit$VC, 2, sd))
  tmp <- cbind(round(tmp, 4), array("-", dim = c(nrow(tmp), 2)))

  out <- rbind(out, tmp)
  return(out)
} 
```

```{r alliancesfigure, fig.cap = "Interstate Alliances in the year 2000. Countries with no interstate alliance recorded are ommitted.", fig.align = "center", out.height="95%"}
knitr::include_graphics("figures/Rplot01.pdf")
```

**Network Statistics**

The alliances data set includes 164 countries^[Because this data set covers the time span of 1981 - 2000, it includes countries which existed at *any* point of given time series. To keep the analysis consistent with the longitudinal analysis, I keep all the observed countries.] with a total of 767 observed interstate alliances. Note that we have a symmetric network matrix, as an alliance between two states is taken to be not directed. It exhibits a network density of 0.0574. 61 countries have no alliance within the data set, the United States and Canade feature the most, with 43 and 39 respectively. The median number of alliances is 9. 

A visualization of the interstate alliance network is provided in Figure \@ref(fig:alliancesfigure). Strong clustering on geographic locations is immediately apparent.  At the upper right of the figure Latin America and the Carribean States, at the right the former USSR countries. Europe and the Middle East form respective clusters. Perhaps more surprisingly there are two distinct clusters of african states. 


```{r results='asis'}
Y <- as.matrix.network(allyNet[["2000"]])
stargazer(gofstats(Y), type = "latex", header = FALSE, title = "Goodness of Fit Statistics for the Year 2000")
```



**SRM & Latent Factor Analysis**

We first fit the model without the SRM Terms. As illustrated in Fig, the model performs quite bad. 

```{r, fig.cap="Goodness of Fit Statistics for the model without SRM Terms (above) and with SRM Terms (below). As indicated by the dependence structure, the second model performs better, taking sender and receiver effects into account.", fig.show = "hold", out.height = "45%"}
fit_SRG <- readRDS(file = "models/SRGmodel.rds")
plot(fit_SRG)

fit_SRM <- readRDS(file = "models/SRMmodel.rds")
plot(fit_SRM)
```

**Modeling interstate alliances**

I follow @geometryofsecurity to define dyadic effects which are both sensible and relevant to the theoretic discussion of interstate alliance networks.^[The author proceeds with a *stochastic actor-oriented* approach for the analysis of longitudinal network data, which relies on different assumptions about the underlying network evolution. However, the relevant network effects are the same.]  

Thus, as dyadic effects I include the geographic distance, a capability ratio, a measure for political similarity and a conflict indicator. As the  distance I take the geographic distance between two capitals, and 0 if both countries share a border. The capability ratio is defined as the log of the relative *Composite Index of National Capability* of both countries, with the stronger state (s) as numerator. Political similiarity is measured with the relative deviation of the *polity score*. This yields the following effects for each country pair $(i,j)$: 
```{=latex}
\begin{align*} 
CapRat_{ij} &= \log\left(\frac{CINC_s}{CINC_w}\right) \\
PolSim_{ij} &= \frac{\Delta - \lvert POLITY_i - POLITY_j \rvert}{\Delta}, \text{  where } \Delta = \max_{ij} \lvert POLITY_i - POLITY_j \rvert
\end{align*}
```
See @geometryofsecurity for the theoretic reasoning behind these indicators. No nodal covariates are defined. Table \@ref(tab:amegeomevolR2) show the parameter estiates for this model and rank 2. 

```{r amegeomevolR2, results ='asis', message = FALSE}
ame_geom_evol_R2 <- readRDS(file = "models/ame_geom_evol_R2.rds")
stargazer(table_ame(ame_geom_evol_R2), type = "latex", header = FALSE, 
          label = "tab:amegeomevolR2",  
          summary = FALSE, title = "Summary of the fully specified rank-2 AME model",
          notes = "Note: MCMC estimates based on 20000 iterations and a output density of 25.")
```

```{r amegeomevolR2plot, results ='asis', message = FALSE, fig.cap = "amegeomevolR2plot"}
ame_geom_evol_R2 <- readRDS(file = "models/ame_geom_evol_R2.rds")
plot(ame_geom_evol_R2)
```


```{r amegeomevolR3plot, results ='asis', message = FALSE, fig.cap = "amegeomevolR3plot"}
ame_geom_evol_R3 <- readRDS(file = "models/ame_geom_evol_R3.rds")
plot(ame_geom_evol_R3)
```


- Does a higher R Latent Factor yield better results?
- Latent Factor Plot
- Does running the mcmc chains improve trace plots


**Extension: Modeling longitudinal data**

Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,



\newpage
# Conclusions

\newpage
# References
