---
title: The Additive and Multiplicative Effects Network Model
subtitle: Seminar on Statistical Modeling of Social Networks
author: Daniel A. Seussler Becerra
date: "June 2021"
output:
  bookdown::pdf_document2: 
    fig_caption: yes
classoption: twoside
fontsize: 11pt
toc: false
geometry: margin=1in 
bibliography: 
  - references.bib
header-includes:
  - \usepackage{float}
  - \usepackage{setspace}\onehalfspacing
  - \usepackage{natbib}\bibliographystyle{agsm}
keywords: Social Networks, Dyadic Data, Bayesian estimation, Latent Factors, International Relations.
abstract: "This seminar paper introduces the Additive and Multiplicative Effects Network Model as proposed in @Hoff2021. First, a general introduction to network and relational data is given along with the statistical challenges of dyadic data analysis. Second, the Additive and Multiplicative Effects model ist introduced and motivated. I then apply this to data from the Alliances Treaty and Obligations Project (ATOP) in the year 2000. *Keywords: Social Networks, Dyadic Data, Bayesian estimation, Latent Factors, International Relations.*"
thanks: "Replication files are available on Github (http://github.com/danielseussler). **Current version**: `r format(Sys.time(),'%B %d, %Y')`; **Corresponding author**: daniel.seussler@gmail.com"
nocite: |
  @Hoff2007, @Hoff2005,
---

\newpage
# Introduction
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.Aenean ma ssa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,


# Theory
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,


**Network Effects** 

* 1st-order: Sender (Receiver) Effects
* 2nd-order: Reciprocity
* 3rd-order: Homophily & Stochastic Equivalence
* System-level - changing actor composition



**Additive Effects: The Social Relations Model**

Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. 
```{=latex}
\begin{align*}
\begin{aligned}
      y_{ij} &= \mu + e_{ij} \\
      e_{ij} &= a_{i} + b_{j} + \epsilon_{ij} \\
      \{ (a_{1}, b_{1}), \ldots, (a_{n}, b_{n}) \} &\sim N(0,\Sigma_{ab}) \\ 
      \{ (\epsilon_{ij}, \epsilon_{ji}) : \; i \neq j\} &\sim N(0,\Sigma_{\epsilon}), \text{ where } \\
      \Sigma_{ab} = \begin{pmatrix} \sigma_{a}^{2} & \sigma_{ab} \\ 
      \sigma_{ab} & \sigma_{b}^2   \end{pmatrix} \;\;\;\;\; &\Sigma_{\epsilon} = \sigma_{\epsilon}^{2} \begin{pmatrix} 1 & \rho \\ 
      \rho & 1  \end{pmatrix}
\end{aligned}
\end{align*}
```
Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc.


**Multiplicative Effects: The Latent Factor Model**

Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi.
```{=latex}
\begin{align*}
  {\textbf{u}_{i},\textbf{v}_{j}} \in \mathbb{R}^{k} \;\; i,j \in \{1, \ldots, n \} \\
\end{align*}
```
Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc. 

```{=latex}
\begin{align*}
\begin{aligned}
  \gamma(\textbf{u}_{i}, \textbf{v}_{j}) &= \textbf{u}_{i}^{T} D \textbf{v}_{j} \\
  &= \sum_{k \in K} d_{k} u_{ik} v_{jk} \\
  &D \text{ is a  } K \times K \text{ diagonal matrix}
\end{aligned}
\end{align*}
```
Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc.


**The AME Model: Additive + Multiplicative Effects**

Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nun.
```{=latex}
\begin{align*}
  \begin{aligned}
      y_{ij,t} &= g(\theta_{ij,t}) \\ 
      &\theta_{ij,t} = \beta^{T} \mathbf{X}_{ij,t} + e_{ij,t} \\
      &e_{ij,t} = a_{i} + b_{j}  + \epsilon_{ij} + \alpha(\textbf{u}_{i}, \textbf{v}_{j}) \text{  , where } \\
      &\qquad \alpha(\textbf{u}_{i}, \textbf{v}_{j}) = \textbf{u}_{i}^{T} \textbf{D} \textbf{v}_{j} = \sum_{k \in K} d_{k} u_{ik} v_{jk} \\ 
  \end{aligned}
\end{align*}
```
Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc.

-@minhas_hoff_ward_2019
-@Hoff2021


**Parameter Estimation and Goodness of Fit**

Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,


**Extensions**

*1. Count, Ordinal and Censored Data*

- @hoff2015longitudinal

*2. Missing Data*


*3. Longitudinal Networks* The last 

\newpage
# Application Case: Interstate Defence Alliances
To illustrate the purpose of network analysis approaches we turn our attention to the field of international relations. More specifically, I apply the beforehand introduced AME network model to the interstate defense alliances network. Alliance formation in the interstate framework provides an interesting application case, both because of the availability of data and the assumed extent of network effects inherent in the strategic decisions of state actors. Neglection of the latter effects by presuming conditional independence of observations, as in the classical regression framework, could seriously bias parameter estimates (@statIssue).

The data is an excerpt from the data used in @ComplexDependencies and @TowardNetwork and contains the yearly defense network as a time series from 1981 - 2000.^[The data set `alliances` can be conveniently accessed as network data in the R-Package `xergm.common`.] It furthermore includes information on military capabilites, political regime types, geographic borders and interstate conflict. From here on out, I refer to this data set as the alliances data set. 

The analysis is structured as follows. First, restricted to a cross-sectional study of the year 2000, I examine the alliances structure with respect to the network statistics and preliminary models, and motivate the application of statistical network approach. Second, a full specification of an AME-model is presented, along with the selection of appropiate parameters. Third, I extend briefly the analysis to include a longitudinal analysis of the network capturing the years 1981-2000. The computational analysis was implemented with the R-Software (@rsoftware) and the AMEN R-Package (@ramen).

```{r setup, echo=FALSE, message=FALSE}
# These options are tuned for manuscript/presentation.
# They basically run R in the background except for spitting out figures/tables

knitr::opts_chunk$set(
	echo = FALSE,
	error = FALSE,
	message = FALSE,
	warning = FALSE
)

library(amen)
library(xergm.common)
library(network)
library(stargazer)
data("alliances")
set.seed(42)

```

```{r output_help, include=FALSE}
# Modified summary function of amen package to output a table easier to handle
table_ame <- function(object, ...){ 
  fit <- object
  tmp <- cbind(
    apply(fit$BETA, 2, mean), apply(fit$BETA, 2, sd),
    apply(fit$BETA, 2, mean) / apply(fit$BETA, 2, sd),
    2 * (1 - pnorm(abs(apply(fit$BETA, 2, mean) / apply(fit$BETA, 2, sd))))
  )
  colnames(tmp) <- c("pmean", "psd", "z-stat", "p-val")
  out <- round(tmp, 4)
  
  
  tmp <- cbind(apply(fit$VC, 2, mean), apply(fit$VC, 2, sd))
  tmp <- cbind(round(tmp, 4), array("-", dim = c(nrow(tmp), 2)))

  out <- rbind(out, tmp)
  return(out)
} 
```

```{r alliancesfigure, fig.cap = "The interstate defense alliances network in the year 2000. Countries with no interstate alliance recorded are ommitted from the plot.", fig.align = "center", out.height="95%"}
knitr::include_graphics("figures/Rplot01.pdf")
```


**Network Statistics**

The alliances data set includes 164 countries^[Because this data set covers the period of 1981 - 2000, it includes all countries which existed at *any* point of given series. To keep the analysis consistent with the longitudinal analysis, I keep all the observed countries.Yemen Arab Republic, Yemen People's Republic, German Democratic Republic, German Federal Republic Czechoslovakia] with a total of 767 observed interstate alliances. A 1 indicates the presence of an alliance between two countries, 0 its absence. Note that we have a symmetric network matrix, as an alliance between two states is taken to be not directed. 61 countries have no alliance within the data set, the United States and Canada feature the most, with 43 and 39 respectively. The median number of alliances is 9. Its network density is 0.0574.

A visualization of the interstate alliance network is provided in Figure \@ref(fig:alliancesfigure). Strong clustering on geographic locations is immediately apparent. Located at the upper right of the figure we find Latin America and the Caribbean States, at the right the former USSR countries. Europe and the Middle East form respective clusters. Perhaps more surprisingly there are two distinct clusters of African states.

```{r netstatyr2000}
netstatyr2000 <- gofstats(as.matrix.network(allyNet[["2000"]]))
```

Observed statistics for network dependence will be used later on to assess model fit. In this regard, the standard deviation of the row- and column means is `r round(netstatyr2000[3], 3)`. Unsurprisingly, because our network is symmetric, within-dyad correlation is `r netstatyr2000[3]`. The normalized measure of triadic dependence is `r round(netstatyr2000[4], 3) `, this indicates strong presence of third-order network effects.


**Preliminary modeling: Social Relations Model and Latent Factors**

We first fit the model without the SRM Terms. The goodness of fit statistics show considerable underestimation of third order network effects.

```{r, fig.cap="Goodness of Fit Statistics for the model without SRM Terms (above) and with SRM Terms (below). As indicated by the dependence structure, the second model performs better, taking sender and receiver effects into account.", fig.show = "hold", out.height = "45%"}
fit_SRG <- readRDS(file = "models/SRGmodel.rds")
plot(fit_SRG)

fit_SRM <- readRDS(file = "models/SRMmodel.rds")
plot(fit_SRM)
```


**The Additive and Multiplicative Effects Model: Interstate Defence Alliances**

I follow the model specification of @geometryofsecurity to define dyadic effects which are both sensible and relevant to the theoretic discussion of interstate alliance networks.^[The author proceeds with a *stochastic actor-oriented* approach for the analysis of longitudinal network data, which describes network dynamics as a stochastic process. However, the covariates of interest are transferable.] See @geometryofsecurity for the theoretic reasoning behind these covariates. 

*1. Nodal Covariates.* As covariates of interest, specific to each actor in the network, I include log GDP per capita and a measure for military capability. GDP per capita for the year 2000 in constant 2010 US$ is taken from the World Development Indicators, World Bank, with @wdipackage. As a measure for military capability, I use the *Composite Index of National Capability (CINC)* which is contained in the alliances data set. Former countries take the value 0 in both cases.

*2. Dyadic Covariates.* As dyadic effects I include the geographic distance, a measure for cultural similarity, a capability ratio, a measure for political similarity, trade flows, and a conflict indicator. The geographic distance between two countries is calculated as the distance between the two respective capitals and set 0 if both countries share a border. To index cultural similarity, I use the data set of @geometryofsecurity for joint languages, i.e., a dichotomous variable which takes the value 1, if the most spoken language of two states is the same, 0 else.^[I use data from the replication files and choose the year 1985, since the year 2000 did't seemed to be accurate. @culturalsimdata is provided as the original data source.] The capability ratio is defined as the log of the relative *Composite Index of National Capability* of both countries, with the stronger state (indicated by the subscript *s*) as the numerator. The political similarity is measured by the degree of relative deviation of the *Polity IV* scores of two network actors. This yields the following effects for each country pair $(i,j)$:
```{=latex}
\begin{align*} 
CapRat_{ij} &= \log\left(\frac{CINC_s}{CINC_w}\right), \\
PolSim_{ij} &= \frac{\Delta - \lvert Polity_i - Polity_j \rvert}{\Delta}, \quad \Delta = \max_{ij} \lvert Polity_i - Polity_j \rvert.
\end{align*}
```
To include trade flows between two countries I use data from the Correlates of War Project on Trade (@tradedata), where trade flow is the sum of imports and exports between two countries. 

Table \@ref(tab:amegeomevolR2) lists the parameter estimates for this model with a latent factor rank of 2. In the case of symmetric network matrices, the mixing of the MCMC estimation is considerably slower [see @hoff2015dyadic, p. 44]. For this reason, I extend the estimation to 1.000.000 iterations with an output density of 100, after a burn-in period of 10.000.  

```{r amegeomevolR2, results ='asis', message = FALSE}
ame_geom_evol_R2 <- readRDS(file = "models/ame_geom_evol_R2.rds")
stargazer(table_ame(ame_geom_evol_R2), type = "latex", header = FALSE, 
          label = "tab:amegeomevolR2",  
          summary = FALSE, title = "Summary of the fully specified rank-2 AME model",
          notes = "Note: MCMC estimates based on 20000 iterations and a output density of 25.")
```

```{r amegeomevolR2plot, results ='asis', message = FALSE, fig.cap = "amegeomevolR2plot"}
ame_geom_evol_R2 <- readRDS(file = "models/ame_geom_evol_R2.rds")
plot(ame_geom_evol_R2)
```


```{r amegeomevolR5plot, results ='asis', message = FALSE, fig.cap = "amegeomevolR5plot"}
ame_geom_evol_R5 <- readRDS(file = "models/ame_geom_evol_R5.rds")
plot(ame_geom_evol_R5)
```


- Does a higher R Latent Factor yield better results?
- Latent Factor Plot for R2? R1?
- Does running the mcmc chains improve trace plots?
- how structure the explanation of the analysis?





\newpage
# Conclusions

More applications of the AME model:

- @violenceNetworks
- @Minhas_Hoff_Ward_2016 (Longitudinal Data)

\newpage
# References
